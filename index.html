<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-SnackPedia ğŸ‡°ğŸ‡·</title>
    
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #f0f2f5; text-align: center; margin: 0; padding: 20px; }
        h1 { color: #d63031; margin-bottom: 5px; font-size: 24px; }
        p.sub-title { color: #636e72; font-size: 14px; margin-bottom: 20px; }
        
        /* ì¹´ë©”ë¼ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #reader { width: 100%; max-width: 400px; margin: 0 auto; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); background: #000; }
        
        /* ê²°ê³¼ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .result-box { display: none; background: white; margin-top: 20px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); text-align: left; }
        .snack-name { font-size: 22px; font-weight: bold; color: #2d3436; margin-bottom: 10px; border-bottom: 2px solid #fab1a0; padding-bottom: 10px; }
        .desc { color: #636e72; line-height: 1.6; font-size: 16px; margin-bottom: 15px; }
        
        /* ë±ƒì§€ ìŠ¤íƒ€ì¼ (ë§µê¸°, ì•ŒëŸ¬ì§€) */
        .badge-container { margin-top: 10px; }
        .badge { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 12px; margin-right: 5px; margin-bottom: 5px; font-weight: bold; }
        .badge-spicy { background-color: #ff7675; color: white; }
        .badge-allergy { background-color: #dfe6e9; color: #2d3436; }

        /* ê´‘ê³  ì˜ì—­ (ë‚˜ì¤‘ì— ì• ë“œì„¼ìŠ¤ ì½”ë“œë¡œ êµì²´) */
        .ad-area { margin-top: 30px; padding: 20px; background: #e1e1e1; color: #888; font-size: 12px; border-radius: 10px; }
    </style>

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>

    <h1>ğŸ‡°ğŸ‡· K-SnackPedia</h1>
    <p class="sub-title">Scan the barcode to verify the taste!</p>

    <div id="reader"></div>

    <div id="result" class="result-box">
        <div class="snack-name" id="name_en">Loading...</div>
        <p class="desc" id="taste_desc">...</p>
        <div class="badge-container" id="badges"></div>
    </div>

    <div class="ad-area">
        Google AdSense Area<br>(Ads will appear here)
    </div>

    <script>
        let snackDB = {};

        // [í•µì‹¬] 1. ê°™ì€ í´ë”ì— ìˆëŠ” snack_db.json íŒŒì¼ì„ ì½ì–´ì˜µë‹ˆë‹¤.
        fetch('./snack_db.json')
            .then(response => response.json())
            .then(data => {
                snackDB = data;
                console.log("DB Loaded:", Object.keys(snackDB).length + " items");
            })
            .catch(error => console.error('Error loading DB:', error));

        // 2. ë°”ì½”ë“œ ìŠ¤ìº”ì— ì„±ê³µí–ˆì„ ë•Œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
        function onScanSuccess(decodedText, decodedResult) {
            // DBì— ìŠ¤ìº”í•œ ë²ˆí˜¸ê°€ ìˆëŠ”ì§€ í™•ì¸
            if (snackDB[decodedText]) {
                const snack = snackDB[decodedText];
                
                // í™”ë©´ì— ì •ë³´ ì±„ì›Œë„£ê¸°
                document.getElementById("name_en").innerText = snack.name_en;
                document.getElementById("taste_desc").innerText = snack.taste_desc;
                
                // ë±ƒì§€ ì´ˆê¸°í™”
                const badgesDiv = document.getElementById("badges");
                badgesDiv.innerHTML = "";
                
                // ë§¤ìš´ë§› ë±ƒì§€ (0ë³´ë‹¤ í¬ë©´ í‘œì‹œ)
                if(snack.spicy_level > 0) {
                    badgesDiv.innerHTML += `<span class="badge badge-spicy">ğŸŒ¶ï¸ Spicy Lv.${snack.spicy_level}</span>`;
                }
                
                // ì•Œë ˆë¥´ê¸° ë±ƒì§€
                if(snack.allergens) {
                    snack.allergens.forEach(a => {
                        badgesDiv.innerHTML += `<span class="badge badge-allergy">âš ï¸ ${a}</span>`;
                    });
                }

                // ìˆ¨ê²¨ë’€ë˜ ê²°ê³¼ ë°•ìŠ¤ ë³´ì—¬ì£¼ê¸°
                document.getElementById("result").style.display = "block";
                
                // ìŠ¤ìº” 3ì´ˆê°„ ë©ˆì¶¤ (ì—°ì† ìŠ¤ìº” ë°©ì§€)
                html5QrcodeScanner.pause();
                setTimeout(() => html5QrcodeScanner.resume(), 3000); 
            } else {
                alert("Sorry! Info coming soon.\nBarcode: " + decodedText);
            }
        }

        // 3. ì¹´ë©”ë¼ ì„¤ì • ë° ì‹œì‘
        const html5QrcodeScanner = new Html5QrcodeScanner(
            "reader", { fps: 10, qrbox: 250 });
        html5QrcodeScanner.render(onScanSuccess);
    </script>

</body>
</html>